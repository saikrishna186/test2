/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

(c) Copyright 2009-2015 SAP SE. All rights reserved
 */
sap.ui.define(['jquery.sap.global','sap/ui/fl/FlexControllerFactory','sap/ui/rta/Utils'],function(q,f,U){"use strict";var F=function(c){};F.M_TYPES={move:"move",addGroup:"addGroup",addField:"addField",property:"property",hideControl:"hideControl",unhideControl:"unhideControl"};F.prototype.init=function(c){this._attachFlexController(c);};F.prototype.destroy=function(){if(this.flexController){delete this.flexController;}};F.prototype.createFlexMoveEvent=function(c,s,t,T,i){var a=F.M_TYPES.move;var C={changeType:a,selector:{id:c}};C.parameters=[{targetAggregation:T,sourceContainerId:s,targetContainerId:t,index:i}];return C;};F.prototype.createFlexPropertyChangeEvent=function(c,p,P){var t=F.M_TYPES.property;var C={changeType:t,selector:{id:c}};C.parameters=[{propertyName:p,newValue:P}];return C;};F.prototype.createHideEvent=function(c){var t=F.M_TYPES.hideControl;var C={changeType:t,selector:{id:c}};return C;};F.prototype.createUnhideEvent=function(c){var t=F.M_TYPES.unhideControl;var C={changeType:t,selector:{id:c}};return C;};F.prototype.createAddGroupEvent=function(c){var v=U.getClosestViewFor(sap.ui.getCore().byId(c.selectorId));var a={selector:{id:c.selectorId},index:c.index,newControlId:v.createId(q.sap.uid()),changeType:F.M_TYPES.addGroup,groupLabel:"New Group"};return a;};F.prototype.createAddFieldEvent=function(c){var a={selector:{id:c.selectorId},index:c.index,newControlId:c.newControlId,changeType:F.M_TYPES.addField,fieldLabel:c.fieldLabel,fieldValue:c.fieldValue,valueProperty:c.valueProperty,jsType:c.jsType,value:c.value};return a;};F.prototype.emitHideEvent=function(c){this._emitFlexEvent(c,this.createHideEvent(c.getId()));};F.prototype.emitUnhideEvent=function(c){this._emitFlexEvent(c,this.createUnhideEvent(c.getId()));};F.prototype.emitAddEvent=function(c,C){var o;if(F.M_TYPES.addField===C){o=this.createAddFieldEvent(c);}else if(F.M_TYPES.addGroup===C){o=this.createAddGroupEvent(c);}this._emitFlexEvent(sap.ui.getCore().byId(c.selectorId),o);return o;};F.prototype.emitMoveEvent=function(e,c){this._emitFlexEvent(e,c);};F.prototype.emitPropertyChangeEvent=function(c,p,P){this._emitFlexEvent(c,this.createFlexPropertyChangeEvent(c.getId(),p,P));};F.prototype.onResetToDefault=function(){var t=this;this.flexController.getComponentChanges().then(function(c){return t.flexController.discardChanges(c).then(function(){window.location.reload();});})['catch'](function(e){q.sap.log.error("Flexibility data could not be discarded "+e);});};F.prototype._attachFlexController=function(c){try{if(f){this.flexController=f.createForControl(c);}else{this.flexController=null;}}catch(e){q.sap.log.error("No DT control can be found for "+c.getMetadata().getName());}};F.prototype._emitFlexEvent=function(c,C){if(this.flexController){this.flexController.createAndApplyChange(C,c);this.flexController.saveAll().then(function(){})["catch"](function(e){q.sap.log.error("Flexibility data could not be saved "+e);});}};return F;},true);
