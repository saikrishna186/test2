/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

(c) Copyright 2009-2015 SAP SE. All rights reserved
 */
sap.ui.define(["jquery.sap.global","sap/ui/fl/Utils","sap/ui/dt/OverlayUtil","sap/ui/dt/ElementUtil","sap/ui/comp/odata/FieldSelectorModelConverter","sap/ui/fl/registry/Settings",'sap/ui/comp/smartform/GroupElement','sap/ui/comp/smartform/Group','sap/ui/comp/smartfield/SmartField'],function(q,F,O,E,a,S,G,b,c){"use strict";var U={};U._aEditableTypes=["sap.ui.comp.smartform.SmartForm","sap.ui.comp.smartform.Group","sap.ui.comp.smartform.GroupElement"];U._sFocusableOverlayClass=".sapUiDtOverlaySelectable";U.isCustomFieldAvailable=function(C){q.sap.require("sap.ui.fl.fieldExt.Access");var s=F.getComponentClassName(C);var d=false;var f=new a(C.getModel());var e;f.getConvertedModel();return S.getInstance(s).then(function(o){if(o.isModelS){d=o.isModelS();}if(!d){return Promise.resolve();}else{var m=f.getMetaDataAnalyzer();try{var g=f.getEntityTypes();if(g&&g.length>0){e=g[0].key;}var p=sap.ui.fl.fieldExt.Access.getBusinessContexts(m.oModel.sServiceUrl,e);p.fail(function(h){if(h){if(q.isArray(h.errorMessages)){for(var i=0;i<h.errorMessages.length;i++){q.sap.log.error(h.errorMessages[i].text);}}}return Promise.resolve();});return p.then(function(r){if(r){if(r.BusinessContexts){if(r.BusinessContexts.length>0){return Promise.resolve(r);}}}});}catch(h){q.sap.log.error("exception occured in sap.ui.fl.fieldExt.Access.getBusinessContexts");return Promise.resolve();}}});};U.isElementHideable=function(e){return((e instanceof G||e instanceof b)&&!this.isElementMandatory(e));};U.isElementMandatory=function(e){var m=false;if(e instanceof G){var f=e.getFields();for(var i=0;i<f.length;i++){var g=f[i];if(g instanceof c){m=g.getMandatory();if(m){break;}}}}else if(e instanceof b){var d=e.getGroupElements();for(var j=0;j<d.length;j++){return this.isElementMandatory(d[j]);}}return m;};U.isOverlayMutable=function(o){var e=o.getElementInstance();var i,I,h,B;i=this._aEditableTypes.some(function(t){return E.isInstanceOf(e,t);});if(i){I=e.getVisible?e.getVisible():true;if(I){h=F.checkControlId(e);if(h){if(E.isInstanceOf(e,"sap.ui.comp.smartform.SmartForm")){B=h;}else{var d=o.getParentElementOverlay();var f=d?d.getElementInstance():null;B=f&&F.checkControlId(f);}}}}return i&&h&&B;};U.isOverlaySelectable=function(o){return o.isSelectable()&&o.$().is(":visible");};U.getPreviousSelectableOverlay=function(o){var p=O.getPreviousOverlay(o);while(p&&!this.isOverlaySelectable(p)){p=O.getPreviousOverlay(p);}return p;};U.getNextSelectableOverlay=function(o){var n=O.getNextOverlay(o);while(n&&!this.isOverlaySelectable(n)){n=O.getNextOverlay(n);}return n;};U.getOverlayInstanceForDom=function(d){var i=q(d).attr("id");if(i){return sap.ui.getCore().byId(i);}};U.getFirstFocusableOverlay=function(){var $=q(this._sFocusableOverlayClass).first();var o=this.getOverlayInstanceForDom($);if(!this.isOverlaySelectable(o)){o=this.getNextSelectableOverlay(o);}return o;};U.getLastFocusableOverlay=function(){var $=q(this._sFocusableOverlayClass).last();var o=this.getOverlayInstanceForDom($);if(!this.isOverlaySelectable(o)){o=this.getPreviousSelectableOverlay(o);}return o;};U.getNextFocusableOverlay=function(){var f=this.getFocusedOverlay();if(f){return this.getNextSelectableOverlay(f);}};U.getPreviousFocusableOverlay=function(){var f=this.getFocusedOverlay();if(f){return this.getPreviousSelectableOverlay(f);}};U.getFocusedOverlay=function(){var e=sap.ui.getCore().byId(document.activeElement.id);if(e instanceof sap.ui.dt.ElementOverlay){return e;}};U.getFirstFocusableChildOverlay=function(o){var f=O.getFirstChildOverlay(o);while(f&&!this.isOverlaySelectable(f)){f=O.getNextSiblingOverlay(f);}return f;};U.getNextFocusableSiblingOverlay=function(o){var n=O.getNextSiblingOverlay(o);while(n&&!this.isOverlaySelectable(n)){n=O.getNextSiblingOverlay(n);}return n;};U.getPreviousFocusableSiblingOverlay=function(o){var p=O.getPreviousSiblingOverlay(o);while(p&&!this.isOverlaySelectable(p)){p=O.getPreviousSiblingOverlay(p);}return p;};U.getClosestViewFor=function(e){if(!e&&!e.getParent){return;}var p=e.getParent();if(p&&p.getMetadata().getName()!=="sap.ui.core.mvc.XMLView"){return this.getClosestViewFor(p);}return p;};U.getClosestTypeForControl=function(C,t){var p=C.getParent();if(p&&p.getMetadata().getName()!==t){return this.getClosestTypeForControl(p,t);}return p;};U._checkIsSupportedControl=function(C,s){for(var i=0;i<s.length;i++){if(C instanceof s[i]){return true;}}};U.hasGroupUnBoundFields=function(g){var e=g.getGroupElements();for(var j=0;j<e.length;j++){var o=e[j];if(!this.hasGroupElementBoundFields(o)){return true;}}return false;};U.hasGroupElementBoundFields=function(g){var e=g.getFields();if(e.length===0){return true;}for(var j=0;j<e.length;j++){var o=e[j];if(!o.getDomRef()){continue;}if(this._isElementBound(o)){return true;}}return false;};U._isElementBound=function(e){var B=e.mBindingInfos;if(Object.keys(B).length===0){return false;}else{for(var p in B){var P=B[p].parts;for(var i=0;i<P.length;i++){if(P[i].model){var m=e.getModel(P[i].model).getMetadata().getName();if(m==="sap.ui.model.odata.ODataModel"||m==="sap.ui.model.odata.v2.ODataModel"){return true;}}else{var m=e.getModel().getMetadata().getName();if(m==="sap.ui.model.odata.ODataModel"||m==="sap.ui.model.odata.v2.ODataModel"){return true;}}}}}};U.findSupportedBlock=function(C,s){if(this._checkIsSupportedControl(C,s)){return C;}else{C=C.getParent();while(C){if(this._checkIsSupportedControl(C,s)){return C;}C=C.getParent();}}};U.createFieldLabelId=function(g,e,f){var C=g.getId()+"_"+e+"_"+f.getBindingPath("value");C=C.replace("/","_");return C;};return U;},true);
