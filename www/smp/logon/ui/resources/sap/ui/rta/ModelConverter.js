/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

(c) Copyright 2009-2015 SAP SE. All rights reserved
 */
sap.ui.define(['jquery.sap.global','sap/ui/comp/odata/FieldSelectorModelConverter','sap/ui/dt/ElementUtil'],function(q,F,E){"use strict";var M={};M.getConvertedModelWithBoundAndRenamedLabels=function(c,e){var t=this;var m=c.getModel();return this._getModelConverter(m).then(function(f){return t._getFieldModel(c,f,e);});};M._getModelConverter=function(m){var o=m.getMetaModel();return o.loaded().then(function(){return new F(m);},function(r){q.sap.log.error("MetadataModel could not be loaded",r);});};M._getFieldModel=function(c,f,e){var C=f.getConvertedModel(e);var v=this._findVisibleAndBoundFieldsAndLabelNames(c);var V=v.visibleAndBoundFields;var m=v.fieldsAndLabelNames;var s;for(var z=0;z<e.length;z++){s=e[z];for(var i=0;i<C[s].length;i++){var a=f.getMetaDataAnalyzer()._getNameOfPropertyUsingComplexType(s,C[s][i].entityName);if(V[C[s][i].name]){C[s][i]["checked"]=true;C[s][i]["controlId"]=V[C[s][i].name];}if(a){C[s][i]["isComplexType"]=true;C[s][i]["complexTypeName"]=a;if(V[a+"/"+C[s][i].name]){C[s][i]["checked"]=true;C[s][i]["controlId"]=V[a+"/"+C[s][i].name];}}if(m[C[s][i].name]&&m[C[s][i].name]!==C[s][i]["sap:label"]){C[s][i]["fieldLabel"]=m[C[s][i].name];}}}return C[s];};M._findVisibleAndBoundFieldsAndLabelNames=function(c){var v=[];var f={};var e=E.findAllPublicElements(c);var i=0;if(c instanceof sap.m.ObjectHeader){for(i=0;i<e.length;i++){var o=e[i];if(o instanceof sap.m.ObjectAttribute){v.push(o.getBindingPath("text"));}}}else if(c instanceof sap.ui.comp.smartform.SmartForm){for(i=0;i<e.length;i++){var a=e[i];if(a.mBindingInfos){for(var I in a.mBindingInfos){var p=a.mBindingInfos[I].parts[0].path?a.mBindingInfos[I].parts[0].path:"";p=p.split("/")[p.split("/").length-1];var P=a.getParent();if(P){if(p&&a.getDomRef()){v[p]=P.getId();f[p]=P.getLabelText();}else if(p){var t=P.getLabelText;if(!t){t=P.getLabel;}if(t){f[p]=t.call(P);v[p]=P.getId();}}}}}}}return{visibleAndBoundFields:v,fieldsAndLabelNames:f};};return M;},true);
