/*
 * ! SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.define(["jquery.sap.global","sap/ui/base/ManagedObject","sap/m/MessageBox","sap/m/Dialog"],function(q,M,a,D){"use strict";var b=M.extend("sap.ui.generic.template.MessageUtil",{metadata:{properties:{controller:{type:"object",group:"Misc",defaultValue:null},response:{type:"object",group:"Misc",defaultValue:null}}}});b.prototype._httpStatusCodes={badRequest:"400",forbidden:"403",methodNotAllowed:"405",preconditionFailed:"428",internalServerError:"500"};b.prototype.handleError=function(p){p=p||{};var e=p.errorContext||{};var E=this.getResponse();var c=this.getController();var m=sap.ui.getCore().getLibraryResourceBundle("sap.ui.generic.template").getText("ERROR_UNKNOWN");var h;if(E instanceof Error){if(E.message){m=E.message;}}else if(E.response){if(E.response.message){m=E.response.message;}if(E.response.statusCode){h=E.response.statusCode;}if(E.response.headers){for(var H in E.response.headers){if(H.toLowerCase()==='content-type'){var s=E.response.headers[H];if(s.toLowerCase().indexOf('application/json')===0){if(E.response.responseText){var o=JSON.parse(E.response.responseText);if(o&&o.error&&o.error.message&&o.error.message.value){m=o.error.message.value;}}}else{if(E.message){m=E.message;}}break;}}}}var S=true;switch(e.lastOperation.name){case'':break;case c.operations.callAction:break;case c.operations.addEntry:S=false;break;case c.operations.modifyEntity:if(this._httpStatusCodes.preconditionFailed===h){S=false;}break;case c.operations.saveEntity:if(e.isDraft){S=false;}break;case c.operations.deleteEntity:break;case c.operations.editEntity:break;case c.operations.validateDraftEntity:break;case c.operations.prepareDraftEntity:S=false;break;case c.operations.activateDraftEntity:break;default:break;}var d={entitySet:e.entitySet,title:p.title,message:m};if(S){if(e.showMessages){this._showMessageBox(d);}}else{this._showMessagePage(d);}};b.prototype._showMessageBox=function(p){sap.m.MessageBox.show(p.message,{icon:p.messageBoxIcon||sap.m.MessageBox.Icon.ERROR,title:p.title||sap.ui.getCore().getLibraryResourceBundle("sap.ui.generic.template").getText("ERROR_TITLE"),actions:[sap.m.MessageBox.Action.OK],onClose:function(A){},styleClass:this._getCompactModeStyleClass()});};b.prototype._showMessagePage=function(p){var n=this.getController().getNavigationController();n.navigateToMessagePage({entitySet:p.entitySet,title:p.title,text:p.message});};b.prototype._getCompactModeStyleClass=function(){if(this.getController().getView().$().closest(".sapUiSizeCompact").length){return"sapUiSizeCompact";}return"";};b.prototype.handleSuccess=function(p){p=p||{};var s=p.successContext||{};var r,m,c;r=this.getResponse();c=this._getMessages(r.response);if(c&&c.length>0){if(c.length===1){m=c[0];if(m.state===sap.ui.core.ValueState.Success){this._showSuccessToast(m);}else{if(s.showMessages){this._showMessages(c);}}}else{if(s.showMessages){this._showMessages(c);}}}};b.prototype._getMessages=function(r){var m=[];if(!r||!r.statusCode){return;}if(r.statusCode.toString().substring(0,1)==="2"){if(r.headers["sap-message"]){var o=r.headers["sap-message"];var c=JSON.parse(o);m.push(this._getMessage(c));if(c.details){for(var i=0;i<c.details.length;i++){m.push(this._getMessage(c.details[i]));}}}}return m;};b.prototype._getMessage=function(m){var i,s;switch(m.severity){case"info":i="sap-icon://sys-enter";s=sap.ui.core.ValueState.Success;break;case"warning":i="sap-icon://notification";s=sap.ui.core.ValueState.Warning;break;case"error":i="sap-icon://error";s=sap.ui.core.ValueState.Error;break;default:i="sap-icon://sys-enter";s=sap.ui.core.ValueState.Success;break;}var o={message:m.message,code:m.messageCode,target:m.target,icon:i,state:s};return o;};b.prototype._showSuccessToast=function(m){sap.m.MessageToast.show(m.message);};b.prototype._showMessages=function(m){var o,d;var t=this;o=new sap.ui.model.json.JSONModel();o.setData({messages:m});d=new sap.m.Dialog({content:t.getMessageTable(),type:sap.m.DialogType.Message,state:"None",afterClose:function(){d.destroy();},buttons:[new sap.m.Button({text:sap.ui.getCore().getLibraryResourceBundle("sap.ui.generic.template").getText("DIALOG_CLOSE"),press:function(){d.close();}})]});d.setModel(o);d.open();};b.prototype.getMessageTable=function(){var m=new sap.m.Table({growing:false,showSeparators:sap.m.ListSeparators.None,inset:false,fixedLayout:false,backgroundDesign:sap.m.BackgroundDesign.Transparent,columns:[new sap.m.Column({hAlign:"Left",vAlign:"Top"})]});var t=this;var c=new sap.m.ColumnListItem({unread:false,vAlign:"Top",type:"{itemType}",press:function(e){t._navigateToDetail(e);},cells:[new sap.ui.layout.Grid({vSpacing:0,hSpacing:1,content:[new sap.m.ObjectStatus({icon:"{icon}",state:"{state}",layoutData:new sap.ui.layout.GridData({span:"L2 M2 S2"})}),new sap.m.Text({maxLines:3,text:"{message}",layoutData:new sap.ui.layout.GridData({span:"L10 M10 S10"})})]})]});m.bindAggregation("items","/messages",c);return m;};return b;},true);
