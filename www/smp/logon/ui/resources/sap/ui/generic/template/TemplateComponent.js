/*
 * ! SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.define(['jquery.sap.global','sap/ui/core/UIComponent','sap/ui/generic/template/library','sap/m/MessageBox','sap/ui/model/json/JSONModel','sap/ui/core/mvc/ViewType'],function(q,U,l,M,J,V){"use strict";var T=U.extend("sap.ui.generic.template.TemplateComponent",{metadata:{properties:{templateName:{type:"string",defaultValue:null},entitySet:{type:"string",defaultValue:null},navigationProperty:{type:"string",defaultValue:null},appComponent:{type:"object",defaultValue:null},isRefreshRequired:{type:"boolean",defaultValue:false},preventBinding:{type:"boolean",defaultValue:false}},library:"sap.ui.generic.template"}});T.prototype.getComponentContainer=function(){return this.oContainer;};T.prototype.setContainer=function(){var m;sap.ui.core.UIComponent.prototype.setContainer.apply(this,arguments);if(this.oContainer){m=this.oContainer.getModel();if(m){m.getMetaModel().loaded().then(function(){this.runAsOwner(function(){var v=this._createXMLView();this.setAggregation("rootControl",v);this.getUIArea().invalidate();}.bind(this));}.bind(this));}}};T.prototype._createXMLView=function(){var v=null;var m=this.getModel().getMetaModel();var E=m.getODataEntitySet(this.getEntitySet());if(!E||!E.entityType){this.handleErrors();return null;}this._enhanceI18nModel();q.sap.require("sap.ui.model.odata.AnnotationHelper");try{var s=this._determineStableID();v=sap.ui.getCore().byId(s);if(v){window.console.warn("View with ID: "+s+" already exists - old view is getting destroyed now!");try{v.destroy();}catch(a){window.console.error("Error destroying view: "+a);}v=null;}var d=new J(sap.ui.Device);d.setDefaultBindingMode("OneWay");v=sap.ui.view({preprocessors:{xml:{bindingContexts:{meta:m.createBindingContext(m.getODataEntityType(E.entityType,true)),entitySet:m.createBindingContext(m.getODataEntitySet(this.getEntitySet(),true))},models:{device:d,meta:m,entitySet:m,parameter:this._createParameterModel(E.entityType)},preprocessorsData:this.getComponentData().preprocessorsData}},id:s,type:V.XML,viewName:this.getTemplateName(),height:"100%"});}catch(e){this.handleErrors(e);throw e;}return v;};T.prototype._determineStableID=function(){if(this.getAppComponent().getMetadata().getComponentName()===""||this.getTemplateName()===""||this.getEntitySet()===""){var t="Stable Id could not be determined in sap.ui.generic.template.TemplateComponent. Either application component name or template name or entity set is empty.";this.handleErrors(new Error(t));throw new Error(t+this);}return this.getAppComponent().getMetadata().getComponentName()+'::'+this.getTemplateName()+'::'+this.getEntitySet();};T.prototype._enhanceI18nModel=function(){var m=this.getAppComponent().getModel('i18n|'+this.getMetadata().getComponentName()+'|'+this.getEntitySet());if(!m){return;}var o=this.getModel('i18n');o.enhance(m.getResourceBundle());};T.prototype._createParameterModel=function(e){var i=this.getAppComponent().getTransactionController().getDraftController().getDraftContext().isDraftEnabled(this.getEntitySet());var s=null;var a=this.getComponentContainer().getSettings();s=q.extend({},a);delete s.appComponent;delete s.entitySet;delete s.navigationProperty;return new J({entitySet:this.getEntitySet(),entityType:e,"sap-ui-debug":window['sap-ui-debug'],isDraftEnabled:i,"settings":s,"manifest":this.getAppComponent().getMetadata().getManifest()});};T.prototype.handleErrors=function(e){var v=this.getAggregation("rootControl");if(!v||!v.getController()){return;}var c=v.getController();c.handleError(e);};T.prototype.destroy=function(){U.prototype.destroy.apply(this,arguments);};T.prototype.getRouter=function(){if(this.getAppComponent()){return this.getAppComponent().getRouter();}return U.prototype.getRouter.apply(this,arguments);};T.prototype.onActivate=function(){this.setIsRefreshRequired(false);};T.prototype.onDeactivate=function(){};return T;},true);
