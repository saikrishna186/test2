(function(){"use strict";jQuery.sap.declare("sap.ovp.cards.ActionUtils");sap.ovp.cards.ActionUtils={};sap.ovp.cards.ActionUtils.getActionInfo=function(c,a,e){function b(P,e,m){if(e&&P&&!P["com.sap.vocabularies.Common.v1.Label"]){var o=m.getODataProperty(e,P.name,false);if(o&&o["com.sap.vocabularies.Common.v1.Label"]){P["com.sap.vocabularies.Common.v1.Label"]=o["com.sap.vocabularies.Common.v1.Label"];}else if(o&&o["sap:label"]){P["sap:label"]=o["sap:label"];}}}var g=function(e){var K={};if(e&&e.key&&e.key.propertyRef){for(var i=0;i<e.key.propertyRef.length;i++){var s=e.key.propertyRef[i].name;K[s]=true;}}return K;};var m=c.getModel().getMetaModel();var f=a.action.split('/')[1];var C=c.getObject();var d={oContext:c,sFunctionImportPath:a.action,sFunctionLabel:a.label,oFunctionImport:m.getODataFunctionImport(f),parameterData:{},allParameters:[]};var p;if(d.oFunctionImport.parameter){var k=g(e);for(var i=0;i<d.oFunctionImport.parameter.length;i++){var P=d.oFunctionImport.parameter[i];b(P,e,m);if(k[P.name]){P.isKey=true;}if(typeof P.nullable==='undefined'){P.nullable=true;}if(C.hasOwnProperty(P.name)){p=C[P.name];}else{p="";}d.parameterData[P.name]=p;d.allParameters.push(P);}}return d;};sap.ovp.cards.ActionUtils.buildParametersForm=function(a,o){function g(p){var L="";if(p["com.sap.vocabularies.Common.v1.Label"]){L=p["com.sap.vocabularies.Common.v1.Label"].String;}else if(p["sap:label"]){L=p["sap:label"];}else{L=p.name;}return L;}jQuery.sap.require("sap.ui.layout.form.SimpleForm");jQuery.sap.require("sap.ui.comp.smartfield.SmartField");var f=new sap.ui.layout.form.SimpleForm({editable:true});var F=[];for(var i=0;i<a.allParameters.length;i++){var p=a.allParameters[i];var P=g(p);var b='{/'+p.name+'}';var j=null;var e=p.type;var m=p.maxLength?parseInt(p.maxLength,10):undefined;if(e==='Edm.Boolean'){j=sap.ui.comp.smartfield.JSONType.Boolean;}else if(e==='Edm.Byte'||e==='Edm.SByte'||e==='Edm.Int16'||e==='Edm.Int32'){j=sap.ui.comp.smartfield.JSONType.Integer;}else{j=sap.ui.comp.smartfield.JSONType.String;}var c=sap.ovp.cards.ActionUtils._isMandatoryParameter(p);var d=new sap.ui.comp.smartfield.SmartField({value:b,mandatory:c,jsontype:j,maxLength:m,editable:!p.isKey});d.attachChange(o);F.push(d);var l=new sap.ui.comp.smartfield.SmartLabel();l.setRequired(c&&!p.isKey);l.setText(P);l.setLabelFor(d);f.addContent(l);f.addContent(d);}return f;};sap.ovp.cards.ActionUtils.getParameters=function(p,f){var a=sap.ovp.cards.ActionUtils._validateParametersValue(p,f);return a.preparedParameterData;};sap.ovp.cards.ActionUtils.mandatoryParamsMissing=function(p,f){var v=sap.ovp.cards.ActionUtils._validateParametersValue(p,f);return v.missingMandatoryParameters&&v.missingMandatoryParameters.length>0;};sap.ovp.cards.ActionUtils._validateParametersValue=function(p,f){var m=[];var M=p.getObject('/');var P={};var v,a;for(var i=0;i<f.parameter.length;i++){var o=f.parameter[i];var s=o.name;if(M.hasOwnProperty(s)){v=M[s];a=sap.ovp.cards.ActionUtils._isMandatoryParameter(o);if(v===undefined||v===""){if(a){if(o.type==='Edm.Boolean'){P[s]=false;}else{m.push(o);}}}else{P[s]=v;}}else{throw new Error("Unknown parameter: "+s);}}return{preparedParameterData:P,missingMandatoryParameters:m};};sap.ovp.cards.ActionUtils._isMandatoryParameter=function(p){return!sap.ovp.cards.ActionUtils._toBoolean(p.nullable);};sap.ovp.cards.ActionUtils._toBoolean=function(p){if(typeof p==="string"){var v=p.toLowerCase();return!(v=="false"||v==""||v==" ");}return!!p;};}());
