// Copyright (c) 2009-2014 SAP SE, All Rights Reserved
(function(){"use strict";jQuery.sap.declare("sap.ovp.cards.AnnotationHelper");sap.ovp.cards.AnnotationHelper={};sap.ovp.cards.AnnotationHelper.formatFunctions={count:0};function g(C,K){if(C.getSetting){var a=C.getSetting("_ovpCache");return a[K];}return undefined;}function s(C,K,v){if(C.getSetting){var a=C.getSetting("_ovpCache");a[K]=v;}}function c(a){var S="None";if(a&&a.EnumMember){var v=a.EnumMember;if(e(v,'Negative')){S="Error";}else if(e(v,'Critical')){S="Warning";}else if(e(v,'Positive')){S="Success";}}return S;}function e(S,a){return S.indexOf(a,S.length-a.length)!==-1;}function d(a){return function(v){v=parseInt(v,10);var D=a.ImprovementDirection.EnumMember;var C={};if(e(D,"Minimize")){var i=a.DeviationRangeHighValue.Int;var T=a.ToleranceRangeHighValue.Int;if(v<=T){C.EnumMember="Positive";}else if(v>i){C.EnumMember="Negative";}else{C.EnumMember="Critical";}}else if(e(D,"Maximize")){var i=parseInt(a.DeviationRangeLowValue.Int,10);var T=parseInt(a.ToleranceRangeLowValue.Int,10);if(v>=T){C.EnumMember="Positive";}else if(v<i){C.EnumMember="Negative";}else{C.EnumMember="Critical";}}else if(e(D,"Target")){var b=a.DeviationRangeLowValue.Int;var u=a.DeviationRangeHighValue.Int;var w=a.ToleranceRangeLowValue.Int;var x=a.ToleranceRangeHighValue.Int;if(v>=w&&v<=x){C.EnumMember="Positive";}else if(v<b||v>u){C.EnumMember="Negative";}else{C.EnumMember="Critical";}}return c(C);};}function f(C,a){var b=C.getPath()+"-DataFields-Sorted";var S=g(C,b);if(!S){var D=h(C,a);var i=D.map(function(u){return u.Value.Path;});var S=a.filter(function(u){if(u.RecordType==="com.sap.vocabularies.UI.v1.DataField"&&i.indexOf(u.Value.Path)===-1){return true;}return false;});n(S);s(C,b,S);}return S;}function h(C,a){var b=C.getPath()+"-DataPoints-Sorted";var S=g(C,b);if(!S){var S=a.filter(function(u){if(u.RecordType==="com.sap.vocabularies.UI.v1.DataFieldForAnnotation"&&u.Target.AnnotationPath.match(/@com.sap.vocabularies.UI.v1.DataPoint.*/)){return true;}return false;});n(S);for(var i=0;i<S.length;i++){var T=S[i].Target.AnnotationPath.slice(1);var E=C.getPath().substr(0,C.getPath().lastIndexOf("/")+1);var P=E+T;S[i]=C.getModel().getProperty(P);}s(C,b,S);}return S;}function j(C,a){var b=C.getPath()+"-Actions-Sorted";var S=g(C,b);if(!S){var S=k(a);s(C,b,S);}return S;}function k(C){var S=C.filter(function(i){return i.RecordType==="com.sap.vocabularies.UI.v1.DataFieldForAction";});n(S);return S;}function l(C){var S=C.filter(function(i){return i.RecordType==="com.sap.vocabularies.UI.v1.DataFieldForIntentBasedNavigation";});n(S);return S;}function m(D){var i;if(D["com.sap.vocabularies.UI.v1.Importance"]){i=D["com.sap.vocabularies.UI.v1.Importance"].EnumMember;}return i;}function n(C){C.sort(function(a,b){var i=m(a),I=m(b);if(i===I){return 0;}if(i==="com.sap.vocabularies.UI.v1.ImportanceType/High"){return-1;}else if(I==="com.sap.vocabularies.UI.v1.ImportanceType/High"){return 1;}else if(i==="com.sap.vocabularies.UI.v1.ImportanceType/Medium"){return-1;}else if(I==="com.sap.vocabularies.UI.v1.ImportanceType/Medium"){return 1;}else if(i==="com.sap.vocabularies.UI.v1.ImportanceType/Low"){return-1;}else if(I==="com.sap.vocabularies.UI.v1.ImportanceType/Low"){return 1;}return-1;});return C;}function o(C,a,i){var b=f(C,a)[i];if(b){return sap.ui.model.odata.AnnotationHelper.format(C,b.Value);}return"";}function p(C,a,i){var b=f(C,a)[i];if(b){return b.Label.String;}return"";}function q(C,a,i){var b=h(C,a)[i];if(b&&b.Title){return b.Title.String;}return"";}function r(C,a,i){var b=h(C,a)[i];if(b){return sap.ui.model.odata.AnnotationHelper.format(C,b.Value);}return"";}function t(C,a,i){var D=h(C,a);var S="None";if(D.length>i){var b=D[i];if(b.Criticality){S=c(b.Criticality);}else if(b.CriticalityCalculation){var F=sap.ui.model.odata.AnnotationHelper.format(C,b.Value);var P=F.match(/path *: *'.*?',/g);if(P){var u=d(b.CriticalityCalculation);sap.ovp.cards.AnnotationHelper.formatFunctions.count++;var N="formatCriticalityCalculation"+sap.ovp.cards.AnnotationHelper.formatFunctions.count;sap.ovp.cards.AnnotationHelper.formatFunctions[N]=u;S="{"+P+" formatter: 'sap.ovp.cards.AnnotationHelper.formatFunctions."+N+"'}";}}}return S;}sap.ovp.cards.AnnotationHelper.formatItems=function(C,E){var S=C.getSetting('ovpCardProperties').oData;var a=E["com.sap.vocabularies.Common.v1.SortOrder"];var b=false,u,v,w,x,y;if(S.sortBy){b=true;y="";v=S.sortBy;if(S.sortOrder){if(S.sortOrder.toLowerCase()==='descending'){x=true;}else{x=false;}}else{x=true;}y="{path: '"+v+"',descending: "+x+"}";}else if(a){b=true;y="";u;for(var i=0;i<a.length;i++){u=a[i];v=u.Property.PropertyPath;w=u.Descending?u.Descending.Value:'false';y=y+"{path: '"+v+"',descending: "+w+"},";}y=y.substring(0,y.length-1);}var z="{path: '/"+E.name+"', length: 5";if(b){z=z+", sorter: ["+y+"]";}z=z+"}";return z;};sap.ovp.cards.AnnotationHelper.formatUrl=function(C,u){if(u.charAt(0)==='/'||u.indexOf("http")===0){return u;}var b=C.getModel().getProperty("/baseUrl");if(b){return b+"/"+u;}return u;};sap.ovp.cards.AnnotationHelper.getDataPointsCount=function(C,a){var D=h(C,a);return D.length;};sap.ovp.cards.AnnotationHelper.getFirstDataPointValue=function(C,a){return sap.ovp.cards.AnnotationHelper.getDataPointValue(C,a,0);};sap.ovp.cards.AnnotationHelper.getSecondDataPointValue=function(C,a){return sap.ovp.cards.AnnotationHelper.getDataPointValue(C,a,1);};sap.ovp.cards.AnnotationHelper.getDataPointValue=function(C,a,i){var D=h(C,a),b=D[i];if(b&&b.Value&&b.Value.Path){return b.Value.Path;}return"";};sap.ovp.cards.AnnotationHelper.getFirstDataFieldName=function(C,a){return p(C,a,0);};sap.ovp.cards.AnnotationHelper.getSecondDataFieldName=function(C,a){return p(C,a,1);};sap.ovp.cards.AnnotationHelper.getThirdDataFieldName=function(C,a){return p(C,a,2);};sap.ovp.cards.AnnotationHelper.formatFirstDataFieldValue=function(C,a){return o(C,a,0);};sap.ovp.cards.AnnotationHelper.formatSecondDataFieldValue=function(C,a){return o(C,a,1);};sap.ovp.cards.AnnotationHelper.formatThirdDataFieldValue=function(C,a){return o(C,a,2);};sap.ovp.cards.AnnotationHelper.formatFourthDataFieldValue=function(C,a){return o(C,a,3);};sap.ovp.cards.AnnotationHelper.formatFifthDataFieldValue=function(C,a){return o(C,a,4);};sap.ovp.cards.AnnotationHelper.formatSixthDataFieldValue=function(C,a){return o(C,a,5);};sap.ovp.cards.AnnotationHelper.getFirstDataPointName=function(C,a){return q(C,a,0);};sap.ovp.cards.AnnotationHelper.getSecondDataPointName=function(C,a){return q(C,a,1);};sap.ovp.cards.AnnotationHelper.getThirdDataPointName=function(C,a){return q(C,a,2);};sap.ovp.cards.AnnotationHelper.formatFirstDataPointValue=function(C,a){return r(C,a,0);};sap.ovp.cards.AnnotationHelper.formatSecondDataPointValue=function(C,a){return r(C,a,1);};sap.ovp.cards.AnnotationHelper.formatThirdDataPointValue=function(C,a){return r(C,a,2);};sap.ovp.cards.AnnotationHelper.formatFirstDataPointState=function(C,a){return t(C,a,0);};sap.ovp.cards.AnnotationHelper.formatSecondDataPointState=function(C,a){return t(C,a,1);};sap.ovp.cards.AnnotationHelper.formatThirdDataPointState=function(C,a){return t(C,a,2);};sap.ovp.cards.AnnotationHelper.hasActions=function(C,a){var b=j(C,a);if(!b||b.length<1){return 0;}return 1;};sap.ovp.cards.AnnotationHelper.getFilteredSortedActions=function(R){var a=k(R);return a;};sap.ovp.cards.AnnotationHelper.getFilteredSortedIntentNavigations=function(R){var i=l(R);return i;};sap.ovp.cards.AnnotationHelper.isFirstDataPointPercentageUnit=function(C,a){var D=h(C,a)[0];if(D&&D.Value&&D.Value.Path){var E=C.getPath().substr(0,C.getPath().lastIndexOf("/")+1);var M=C.getModel();var b=M.getProperty(E);var P=M.getODataProperty(b,D.Value.Path);if(P&&P["Org.OData.Measures.V1.Unit"]){return P["Org.OData.Measures.V1.Unit"].String==="%";}}return false;};sap.ovp.cards.AnnotationHelper.resolveEntityTypePath=function(a){var A=a.getObject();var M=a.getModel();var b=M.getProperty("/metaModel");var E=b.getODataEntitySet(M.getProperty("/entitySet"));var i=b.getODataEntityType(E.entityType);A=i.$path+"/"+A;return b.createBindingContext(A);};sap.ovp.cards.AnnotationHelper.getFirstDataFieldName.requiresIContext=true;sap.ovp.cards.AnnotationHelper.getSecondDataFieldName.requiresIContext=true;sap.ovp.cards.AnnotationHelper.getThirdDataFieldName.requiresIContext=true;sap.ovp.cards.AnnotationHelper.formatFirstDataFieldValue.requiresIContext=true;sap.ovp.cards.AnnotationHelper.formatSecondDataFieldValue.requiresIContext=true;sap.ovp.cards.AnnotationHelper.formatThirdDataFieldValue.requiresIContext=true;sap.ovp.cards.AnnotationHelper.formatFourthDataFieldValue.requiresIContext=true;sap.ovp.cards.AnnotationHelper.formatFifthDataFieldValue.requiresIContext=true;sap.ovp.cards.AnnotationHelper.formatSixthDataFieldValue.requiresIContext=true;sap.ovp.cards.AnnotationHelper.getDataPointsCount.requiresIContext=true;sap.ovp.cards.AnnotationHelper.getFirstDataPointName.requiresIContext=true;sap.ovp.cards.AnnotationHelper.getSecondDataPointName.requiresIContext=true;sap.ovp.cards.AnnotationHelper.getThirdDataPointName.requiresIContext=true;sap.ovp.cards.AnnotationHelper.formatFirstDataPointValue.requiresIContext=true;sap.ovp.cards.AnnotationHelper.formatSecondDataPointValue.requiresIContext=true;sap.ovp.cards.AnnotationHelper.formatThirdDataPointValue.requiresIContext=true;sap.ovp.cards.AnnotationHelper.formatFirstDataPointState.requiresIContext=true;sap.ovp.cards.AnnotationHelper.formatSecondDataPointState.requiresIContext=true;sap.ovp.cards.AnnotationHelper.formatThirdDataPointState.requiresIContext=true;sap.ovp.cards.AnnotationHelper.formatItems.requiresIContext=true;sap.ovp.cards.AnnotationHelper.formatUrl.requiresIContext=true;sap.ovp.cards.AnnotationHelper.hasActions.requiresIContext=true;sap.ovp.cards.AnnotationHelper.getFirstDataPointValue.requiresIContext=true;sap.ovp.cards.AnnotationHelper.getSecondDataPointValue.requiresIContext=true;sap.ovp.cards.AnnotationHelper.isFirstDataPointPercentageUnit.requiresIContext=true;}());
