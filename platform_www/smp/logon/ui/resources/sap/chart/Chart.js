/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

(c) Copyright 2009-2015 SAP SE. All rights reserved
 */
sap.ui.define(['sap/viz/ui5/controls/VizFrame','sap/viz/ui5/controls/common/BaseControl','sap/viz/ui5/data/Dataset','sap/viz/ui5/data/FlattenedDataset','sap/viz/ui5/data/DimensionDefinition','sap/viz/ui5/data/MeasureDefinition','sap/chart/data/Dimension','sap/chart/data/Measure','sap/ui/model/analytics/ODataModelAdapter','sap/chart/utils/RoleFitter','sap/chart/utils/ChartUtils','sap/viz/ui5/controls/common/feeds/FeedItem','sap/ui/model/Filter','sap/ui/model/FilterOperator'],function(V,B,D,F,a,M,b,c,O,R,C,e,f,g){"use strict";var h=B.extend("sap.chart.Chart",{metadata:{library:"sap.chart",properties:{chartType:{type:"string",defaultValue:"bar"},visibleDimensions:{type:"string[]",defaultValue:[]},visibleMeasures:{type:"string[]",defaultValue:[]},vizProperties:{type:"object",group:"Misc"},vizScales:{type:"object[]",group:"Misc"},legendVisible:{type:"boolean",group:"Misc",defaultValue:true},isAnalytical:{type:"boolean",defaultValue:false},selectionBehavior:{type:"string",defaultValue:"DATAPOINT"},selectionMode:{type:"string",defaultValue:"INCLUSIVE"}},aggregations:{data:{type:"sap.ui.core.Element",multiple:true,bindable:"bindable"},_vizFrame:{type:"sap.viz.ui5.controls.VizFrame",multiple:false,visibility:"hidden"},dimensions:{type:"sap.chart.data.Dimension",multiple:true},measures:{type:"sap.chart.data.Measure",multiple:true}},events:{drilledDown:{parameters:{dimensions:{type:"string[]"}}},drilledUp:{parameters:{dimensions:{type:"string[]"}}},renderComplete:{},selectData:{},deselectData:{}}},renderer:function(r,d){r.write("<div");r.writeControlData(d);r.addStyle("width",d.getWidth());r.addStyle("height",d.getHeight());r.writeStyles();r.write(">");r.renderControl(d.getAggregation("_vizFrame"));r.write("</div>");}});h.getMetadata().getAggregation("data")._doesNotRequireFactory=true;function l(v){return v.indexOf("%")!==-1?"100%":v;}h.prototype.setHeight=function(v){this.setProperty("height",v);var d=this._getVizFrame();if(d){d.setHeight(l(this.getProperty("height")));}return this;};h.prototype.setWidth=function(v){this.setProperty("width",v);var d=this._getVizFrame();if(d){d.setWidth(l(this.getProperty("width")));}return this;};h.prototype.setChartType=function(s,S){this.setProperty("chartType",s,S);this._invalidateBy({source:this,keys:{vizFrame:true}});return this;};h.prototype.removeDimension=function(d){var r=this.removeAggregation("dimensions",d);if(r){var v=this._getVisibleDimensions()||[],i=v.indexOf(r.getName());if(i!==-1){v.splice(i,1);this.setVisibleDimensions(v);}}return r;};h.prototype.removeAllDimensions=function(){var r=this.removeAllAggregation("dimensions");this.setVisibleDimensions([]);return r;};h.prototype.destroyDimensions=function(){var r=this.destroyAggregation("dimensions");this.setVisibleDimensions([]);return r;};h.prototype.removeMeasure=function(m){var r=this.removeAggregation("measures",m);if(r){var v=this._getVisibleMeasures()||[],i=v.indexOf(r.getName());if(i!==-1){v.splice(i,1);this.setVisibleMeasures(v);}}return r;};h.prototype.removeAllMeasures=function(){var r=this.removeAllAggregation("measures");this.setVisibleMeasures([]);return r;};h.prototype.destroyMeasures=function(){var r=this.destroyAggregation("measures");this.setVisibleMeasures([]);return r;};h.prototype._getVisibleDimensions=function(){var s=this._getDrillStateTop();return s?s.dimensions:this.getProperty("visibleDimensions");};h.prototype.getVisibleDimensions=function(){var v=this._getVisibleDimensions();return this._aUnusedVisibles?v.filter(function(d){return this._aUnusedVisibles.indexOf(d)===-1;},this):v;};h.prototype._getVisibleMeasures=function(){var s=this._getDrillStateTop();return s?s.measures:this.getProperty("visibleMeasures");};h.prototype.getVisibleMeasures=function(){var v=this._getVisibleMeasures();return this._aUnusedVisibles?v.filter(function(d){return this._aUnusedVisibles.indexOf(d)===-1;},this):v;};h.prototype.setVisibleDimensions=function(d,s){this.setProperty("visibleDimensions",d,s);this._createDrillStack();this._invalidateBy({source:this,keys:{binding:true,dataSet:true,vizFrame:true}});return this;};h.prototype.setVisibleMeasures=function(m,s){this.setProperty("visibleMeasures",m,s);this._createDrillStack();this._invalidateBy({source:this,keys:{binding:true,dataSet:true,vizFrame:true}});return this;};h.prototype._normalizeDorM=function(m,i){var A=i?this.getDimensions():this.getMeasures(),L=A.reduce(function(j,k){j[k.getName()]=k;return j;},{}),d=i?b:c;var r=m.reduce(function(r,N){var s;if(typeof N==="string"){s=N;}else if(N instanceof d){s=N.getName();}else{r.errors.push(N);}if(L[s]){r.normalized.push(L[s]);}else{r.errors.push(N);}return r;},{normalized:[],errors:[]});var n=r.normalized;if(r.errors.length>0){n.errors=r.errors;}return n;};h.prototype._redundantsFromSelection=function(){var s=this._getVizFrame().vizSelection();if(!s||s.length===0){return{measureNames:{}};}var S=s.reduce(function(m,d){jQuery.each(d.data,function(k,v){if(!m[k]){m[k]=[];}if(m[k].indexOf(v)===-1){m[k].push(v);}});return m;},{});var r=this._getVisibleDimensions().reduce(function(m,d){var v=S[d];if(v.length===1){m[d]=v[0];}return m;},{});r.measureNames=this._getVisibleMeasures().reduce(function(m,d){if(!S[d]){m[d]=true;}return m;},{});return r;};h.prototype._deriveFilterFromSelection=function(){var v=this._getVisibleDimensions();var d=this._getVizFrame().vizSelection().map(function(s){var j=v.reduce(function(k,m){k.filters.push(new f({path:m,operator:g.EQ,value1:s.data[m]}));k.signature.push(m+"="+s.data[m]);return k;},{filters:[],signature:[]});j.signature=j.signature.join(";");return j;});var u=d.reduce(function(m,j){if(!m[j.signature]&&j.filters.length>0){m[j.signature]=new f(j.filters,true);}return m;},{});var i=Object.keys(u).map(function(k){return u[k];});if(i.length>1){return new sap.ui.model.Filter(i,false);}else if(i.length===1){return i[0];}else{return null;}};h.prototype._checkDrilldownValid=function(i){var v=this._getVisibleDimensions().reduce(function(m,j){m[j]=true;return m;},{});if(i.some(function(j){return v[j.getName()];})){jQuery.sap.log.error("Drill down not possible, because one of the given dimensions is already drilled down!");return false;}var A=i.reduce(function(r,j){r[j.getName()]=j;return r;},{});function d(j){if(jQuery.isArray(j.aFilters)){return j.aFilters.some(d);}else{return!!A[j.sPath];}}var s=this._getDrillStateTop();if(s.filter&&d(s.filter)){jQuery.sap.log.error("Drill down not possible, because one of the given dimensions is already filtered!");return false;}return true;};h.prototype._createDrillStack=function(){var v=this.getProperty("visibleDimensions")||[],d=this.getProperty("visibleMeasures")||[],s=[{dimensions:[],measures:d,filter:undefined}],S=[];for(var i=0;i<v.length;i++){S.push(v[i]);s.push({dimensions:S.slice(),measures:d,filter:undefined});}this._drillStateStack=s;};h.prototype._invalidateBy=function(d){var s=d.source;var u=this._mNeedToUpdate||{};if(s===this){jQuery.each(d.keys||{},function(k,v){u[k]=v;});}else if(s instanceof c&&this._getVisibleMeasures().indexOf(s.getName())!==-1){u.dataSet=true;u.vizFrame=true;}else if(s instanceof b&&this._getVisibleDimensions().indexOf(s.getName())!==-1){u.dataSet=true;u.vizFrame=true;if(s.getDisplayText()&&(d.property==="textProperty"||d.property==="displayText")){u.binding=true;}}this._mNeedToUpdate=u;this.invalidate(d);};h.prototype._updaters=(function(){function d(j){var t=j.getTextProperty(),I=[{name:j.getName(),grouped:false,inResult:false,visible:true}];if(j.getDisplayText()&&t){I.push({name:t,grouped:false,inResult:false,visible:true});}return I;}function i(m){var u=m.getUnitBinding(),I=[{name:m.getName(),total:false,inResult:false,visible:true}];if(u){I.push({name:u,total:false,inResult:false,visible:true});}return I;}return{drillStack:function(){this._createDrillStack();},dataSet:function(){var j=this._getDataset();j.updateData.apply(j,arguments);},binding:function(){var j=this._getDataset().getBinding("data");if(!j){return;}var k=this._normalizeDorM(this._getVisibleDimensions(),true),m=this._normalizeDorM(this._getVisibleMeasures(),false);if(j.updateAnalyticalInfo){var A=k.reduce(function(I,n){return I.concat(d(n));},[]).concat(m.reduce(function(I,n){return I.concat(i(n));},[]));j.updateAnalyticalInfo(A);}var s=this._getDrillStateTop();if(k.length>0||m.length>0){this._getVizFrame()._pendingDataRequest(true);this.setBusy(true);}j.filter(s.filter?s.filter:undefined);},vizFrame:function(){this._aUnusedVisibles=null;var j=this._normalizeDorM(this._getVisibleDimensions(),true),m=this._normalizeDorM(this._getVisibleMeasures(),false),k=this._getDataset(),v=this._getVizFrame();k.removeAllAggregation("dimensions",true);k.removeAllAggregation("measures",true);v.removeAllAggregation("feeds",true);var n=R.fit(this.getChartType(),j,m,"color",this._mDataTypes);this._aUnusedVisibles=n._unused;n._def.dim.forEach(function(q){k.addAggregation("dimensions",q,true);},this);n._def.msr.forEach(function(q){k.addAggregation("measures",q,true);},this);n.forEach(function(q){v.addFeed(q);});v.invalidate();k.invalidate();v.setVizType(this.getChartType());v.setVizProperties(this._getHostedVizProperties());}};})();h.prototype._getDrillStateTop=function(){return this._drillStateStack?this._drillStateStack[this._drillStateStack.length-1]:null;};h.prototype._getVizFrame=function(){return this.getAggregation("_vizFrame");};h.prototype._getDataset=function(){var v=this._getVizFrame();return v?v.getDataset():null;};h.prototype._bindingDataReceivedListener=function(){var v=this._getVizFrame();this.setBusy(false);v._pendingDataRequest(false);v.invalidate();};h.prototype.addData=function(){jQuery.sap.log.error('Chart manages the "data" aggregation only via data binding. The method "addData" therefore cannot be used programmatically!');};h.prototype.destroyData=function(){jQuery.sap.log.error('Chart manages the "data" aggregation only via data binding. The method "destroyData" therefore cannot be used programmatically!');};h.prototype.getData=function(){jQuery.sap.log.error('Chart manages the "data" aggregation only via data binding. The method "getData" therefore cannot be used programmatically!');};h.prototype.indexOfData=function(){jQuery.sap.log.error('Chart manages the "data" aggregation only via data binding. The method "indexOfData" therefore cannot be used programmatically!');};h.prototype.insertData=function(){jQuery.sap.log.error('Chart manages the "data" aggregation only via data binding. The method "insertData" therefore cannot be used programmatically!');};h.prototype.removeData=function(){jQuery.sap.log.error('Chart manages the "data" aggregation only via data binding. The method "removeData" therefore cannot be used programmatically!');};h.prototype.removeAllData=function(){jQuery.sap.log.error('Chart manages the "data" aggregation only via data binding. The method "removeAllData" therefore cannot be used programmatically!');};h.prototype.bindAggregation=function(n,d){if(n==="data"&&this.getIsAnalytical()){if(d&&d.parameters){d.parameters.analyticalInfo=[{name:""}];}var m=this.getModel(d.model);if(m){O.apply(m);}}return B.prototype.bindAggregation.apply(this,arguments);};h.prototype._bindAggregation=function(n,d){if(n==="data"&&this.getIsAnalytical()){var m=this.getModel(d.model);if(m){O.apply(m);var r=m.getAnalyticalExtensions().getAllQueryResults()[d.parameters.entitySet];var k={};jQuery.each(r.getAllDimensions(),function(z,v){k[z]=v._oProperty.type;});jQuery.each(r.getAllMeasures(),function(z,v){k[z]=v._oProperty.type;});this._mDataTypes=k;var q=this.getAggregation("dimensions");var s=this.getAggregation("measures");if((q===null||q.length===0)&&(s===null||s.length===0)){var t=r.getEntityType().getQName();t=t.slice(t.lastIndexOf(".")+1);q=r.getAllDimensions();for(var i in q){var u=q[i].getName();this.addDimension(new b({name:u,label:"{/#"+t+"/"+u+"/@sap:label}",textProperty:"{/#"+t+"/"+u+"/@sap:text}"}));}s=r.getAllMeasures();for(var j in s){var w=s[j].getName();this.addMeasure(new c({name:w,label:"{/#"+t+"/"+w+"/@sap:label}"}));}}}var x=this._getDataset(),y=x.getBinding("data");if(y){y.detachChange(this._bindingDataReceivedListener,this);}x.bindAggregation("data",d);x.getBinding("data").attachChange(this._bindingDataReceivedListener,this);this._invalidateBy({source:this,keys:{binding:true,vizFrame:true}});}else{B.prototype._bindAggregation.apply(this,arguments);}};h.prototype.unbindAggregation=function(n,s){if(n==="data"){var d=this._getDataset();if(d){d.unbindAggregation.apply(d,arguments);}}return B.prototype.unbindAggregation.apply(this,arguments);};h.prototype.onBeforeRendering=function(){B.prototype.onBeforeRendering.apply(this,arguments);var t=this,u=this._updaters,n=this._mNeedToUpdate||{};jQuery.each(u,function(k,d){if(n[k]){d.call(t);n[k]=false;}});};h.prototype.onAfterRendering=function(){};h.prototype.exit=function(){this._getDataset().unbindAggregation('data',true);B.prototype.exit.apply(this,arguments);if(this._delegateEventHandlers){this._delegateEventHandlers.forEach(function(H){this["detach"+H.name](H.handler,this);delete H.handler;},this);delete this._delegateEventHandlers;}};h.prototype.applySettings=function(){sap.ui.core.Control.prototype.applySettings.apply(this,arguments);var d=new sap.viz.ui5.data.FlattenedDataset();var v=new V({width:l(this.getWidth()),height:l(this.getHeight()),vizType:this.getChartType(),uiConfig:this.getUiConfig(),vizProperties:jQuery.extend(true,{},this.getVizProperties(),this._getHostedVizProperties()),legendVisible:this.getLegendVisible()});v.setDataset(d);this.setAggregation("_vizFrame",v);this._delegateEvents();};h.prototype.resetLayout=function(){this._invalidateBy({source:this,keys:{binding:true,vizFrame:true,drillStack:true,dataSet:true}});return this;};var _=(function(){function m(k){return k.reduce(function(L,K){L[K]=true;return L;},{});}function t(v,k){var q=m(v);function r(s){return k.reduce(function(P,u){if(s.hasOwnProperty(u)){P[u]=s[u];}return P;},{});}return function(s,u){return s.filter(function(w){return q[w];}).map(function(w){var x=r(u);x[w]="*";return{data:x};});};}function d(v,k){var q=m(v);return function(r){return{index:r._context_row_number,measures:Object.keys(r).filter(function(s){return q[s];})};};}function i(q){var r={data:{}},s=q.measures,u=q.dimensions;if(s){r.data.measureNames=(s instanceof Array)?{"in":s}:s;}jQuery.each(u||{},function(k,v){r.data[k]=(v instanceof Array)?{"in":v}:v;});return r;}function j(q){var r=q.data;return Object.keys(r).reduce(function(s,k){var v=r[k];if(v.in&&v.in instanceof Array){v=v.in;}if(k==="measureNames"){s.measures=v;}else if(!s.dimensions){s.dimensions={};s.dimensions[k]=v;}else{s.dimensions[k]=v;}return s;},{});}function n(v,k,q,r){var s=t(v,k);return r.reduce(function(u,w){var x=q.getContexts(w.index,1);if(x.length>0){u=u.concat(s(w.measures,x[0].getObject()));}return u;},[]);}return{makeLookUp:m,toVizCtx:t,fromVizCtx:d,toVizCSCtx:i,fromVizCSCtx:j,buildSelectionVizCtx:n,match:function(r,v,q){return Object.keys(r).every(function(k){if(q.indexOf(k)!==-1){return v.hasOwnProperty(k);}else{return r[k]===v[k];}});}};})();h.prototype.setSelectedDataPoints=function(d){var i=this.getBinding("data"),v=this._getVizFrame();if(!i||!v||this.getSelectionBehavior().toUpperCase()!=="DATAPOINT"){return this;}v.vizSelection(_.buildSelectionVizCtx(this._getVisibleMeasures(),this._getVisibleDimensions(),i,d),{selectionMode:"exclusive"});return this;};h.prototype.addSelectedDataPoints=function(d){var i=this.getBinding("data"),v=this._getVizFrame();if(!i||!v||this.getSelectionBehavior().toUpperCase()!=="DATAPOINT"){return this;}v.vizSelection(_.buildSelectionVizCtx(this._getVisibleMeasures(),this._getVisibleDimensions(),i,d),{selectionMode:"inclusive"});return this;};h.prototype.getSelectedDataPoints=function(){var v=this._getVizFrame();if(!v||this.getSelectionBehavior().toUpperCase()!=="DATAPOINT"){return{count:0,dataPoints:[]};}var d=_.fromVizCtx(this._getVisibleMeasures(),this._getVisibleDimensions());var s=v.vizSelection(),S=s.map(function(n){return n.data;}).map(d).reduce(function(m,j){var k=j.index;m[k]=jQuery.extend(true,m[k]||{},_.makeLookUp(j.measures));return m;},{});var i=this._getDataset();return{count:s.length,dataPoints:Object.keys(S).map(function(j){var k=parseInt(j,10);return{index:k,measures:Object.keys(S[j]),context:i.findContext({_context_row_number:k})};})};};h.prototype.removeSelectedDataPoints=function(d){var i=this.getBinding("data"),v=this._getVizFrame();if(!v||this.getSelectionBehavior().toUpperCase()!=="DATAPOINT"){return this;}var j=this._getVisibleMeasures();var k=this._getVisibleDimensions();var t=_.buildSelectionVizCtx(j,k,i,d);v.vizSelection(t,{deselection:true});return this;};h.prototype.setSelectedCategories=function(d){var v=this._getVizFrame(),s=this.getSelectionBehavior().toUpperCase();if(!v||s!=="CATEGORY"){return this;}v.vizSelection(d.map(_.toVizCSCtx),{selectionMode:"exclusive"});return this;};h.prototype.addSelectedCategories=function(d){var v=this._getVizFrame(),s=this.getSelectionBehavior().toUpperCase();if(!v||s!=="CATEGORY"){return this;}v.vizSelection(d.map(_.toVizCSCtx),{selectionMode:"inclusive"});return this;};h.prototype.removeSelectedCategories=function(d){var v=this._getVizFrame(),s=this.getSelectionBehavior().toUpperCase();if(!v||s!=="CATEGORY"){return this;}v.vizSelection(d.map(_.toVizCSCtx),{deselection:true});return this;};h.prototype.getSelectedCategories=function(){var v=this._getVizFrame(),s=this.getSelectionBehavior().toUpperCase();if(!v||s!=="CATEGORY"){return{count:0,categories:[]};}else{var S=v.vizSelection();return{count:S.length,categories:(S.category||[]).map(_.fromVizCSCtx)};}};h.prototype.setSelectedSeries=function(s){var v=this._getVizFrame(),d=this.getSelectionBehavior().toUpperCase();if(!v||d!=="SERIES"){return this;}v.vizSelection(s.map(_.toVizCSCtx),{selectionMode:"exclusive"});return this;};h.prototype.addSelectedSeries=function(s){var v=this._getVizFrame(),d=this.getSelectionBehavior().toUpperCase();if(!v||d!=="SERIES"){return this;}v.vizSelection(s.map(_.toVizCSCtx),{selectionMode:"inclusive"});return this;};h.prototype.removeSelectedSeries=function(s){var v=this._getVizFrame(),d=this.getSelectionBehavior().toUpperCase();if(!v||d!=="SERIES"){return this;}v.vizSelection(s.map(_.toVizCSCtx),{deselection:true});return this;};h.prototype.getSelectedSeries=function(){var v=this._getVizFrame(),s=this.getSelectionBehavior().toUpperCase();if(!v||s!=="SERIES"){return{count:0,series:[]};}else{var S=v.vizSelection();return{count:S.length,series:(S.series||[]).map(_.fromVizCSCtx)};}};h.prototype.drillDown=function(d){if(d&&!(d instanceof Array)){d=[d];}var i=this._normalizeDorM(d,true);if(i.length===0){return;}if(!this._checkDrilldownValid(i)){jQuery.sap.log.warning("Drill down not possible for "+i+". Already drilled down.");return;}var s=this._getDrillStateTop(),r=this._redundantsFromSelection(),S=this._deriveFilterFromSelection();var n;if(S){n=!s.filter?S:new f([S,s.filter],true);}this._drillStateStack.push({dimensions:s.dimensions.slice().concat(i.map(function(k){return k.getName();})).filter(function(k){return!r[k];}),measures:s.measures.filter(function(m){return!r.measureNames[m];}),filter:n,redundant:r});var j=i.map(function(k){return k.getName();});this.fireDrilledDown({dimensions:j});this._invalidateBy({source:this,keys:{binding:true,vizFrame:true}});};h.prototype.drillUp=function(){if(this._drillStateStack.length>1){var P=this._drillStateStack.pop(),s=this._getDrillStateTop();this.fireDrilledUp({dimensions:P.dimensions.filter(function(d){return s.dimensions.indexOf(d)===-1;})});this._invalidateBy({source:this,keys:{binding:true,vizFrame:true}});}};h.prototype.setUiConfig=function(u){this.setProperty("uiConfig",u);if(this._getVizFrame()){this._getVizFrame().setUiConfig(u);}};h.prototype.setLegendVisible=function(v){this.setProperty("legendVisible",v);if(this._getVizFrame()){this._getVizFrame().setLegendVisible(this.getProperty("legendVisible"));}};h.prototype.getLegendVisible=function(){if(this._getVizFrame()){return this._getVizFrame().getLegendVisible();}else{return this.getProperty("legendVisible");}};var o=(function(){var d=["interaction.selectability.mode","interaction.selectability.behavior"];function i(j,k){var t=j,v;v=k.reduce(function(n,q){if(t.hasOwnProperty(q)){n.push({parent:t,val:t[q],key:q});t=t[q];}return n;},[]);if(v.length!==k.length){return;}var m=v.pop();delete m.parent[m.key];while(v.length>0){m=v.pop();if(Object.keys(m.val).length>0){return;}else{delete m.parent[m.key];}}}function s(v){var r=jQuery.extend(true,{},v);d.forEach(function(j){delete r[j];i(r,j.split("."));});return r;}return{sanitize:s};})();h.prototype.setVizProperties=function(v){v=o.sanitize(v);this.setProperty("vizProperties",v);if(this._getVizFrame()){this._getVizFrame().setVizProperties(v);}};h.prototype.getVizProperties=function(){var v=this._getVizFrame();return o.sanitize(v?v.getVizProperties():this.getProperty("vizProperties"));};h.prototype.setVizScales=function(v){this.setProperty("vizScales",v);if(this._getVizFrame()){this._getVizFrame().setVizScales(v);}};h.prototype.getVizScales=function(){var v=this._getVizFrame();return v?v.getVizScales():this.getProperty("vizScales");};h.prototype.getVizUid=function(){return this._getVizFrame().getVizUid();};h.prototype.zoom=function(d){this._getVizFrame().zoom(d);};var p=["selectData","deselectData","renderComplete"];h.prototype._delegateEvents=function(){if(this._delegateEventHandlers){return;}var v=this._getVizFrame();this._delegateEventHandlers=p.map(function(E){var n=E.charAt(0).toUpperCase()+E.slice(1);var d=function(i){var P=i.getParameters();delete P.id;this.fireEvent(E,P);};d=d.bind(this);v["attach"+n](null,d);return{name:n,handler:d};},this);};h.prototype.getChartTypes=function(){return C.CONFIG.chartTypes.slice();};h.prototype.getAvailableChartTypes=function(){var A=[];var d=this.getChartTypes();var n=this.getVisibleDimensions().length;var N=this.getVisibleMeasures().length;var s="";var I=false;for(var i=0;i<d.length;i++){s=d[i];if(s=="pie"||s=="donut"||s=="heatmap"){I=N!=1;}else if(s=="scatter"||s=="treemap"){I=N!=2;}else if(s=="bubble"){I=N!=3;}else if(s.indexOf("stacked")!=-1){I=(N+n)<3;}if(s.indexOf("dual")!=-1||s.indexOf("combination")!=-1||s.indexOf("bullet")!=-1){I=N<2;}if(!I){A.push(d[i]);}}return A;};h.prototype._hostedVizProperties={selectionMode:{prop:"interaction.selectability.mode"},selectionBehavior:{prop:"interaction.selectability.behavior"}};h.prototype._getHostedVizProperties=function(){var t=this;return Object.keys(t._hostedVizProperties).reduce(function(d,i){var s=t._hostedVizProperties[i].prop.split(".").reverse().reduce(function(d,j){var r={};r[j]=d;return r;},t.getProperty(i));return jQuery.extend(true,d,s);},{});};h.prototype.setSelectionMode=C.hostVizPropertySetter("selectionMode","interaction.selectability.mode",{convert:function(s){return s?s.toUpperCase():s;},validate:function(s){return["INCLUSIVE","EXCLUSIVE"].indexOf(s)!==-1;}});h.prototype.getSelectionMode=C.hostVizPropertyGetter("selectionMode","interaction.selectability.mode");h.prototype.setSelectionBehavior=C.hostVizPropertySetter("selectionBehavior","interaction.selectability.behavior",{convert:function(s){return s?s.toUpperCase():s;},validate:function(s){return["DATAPOINT","CATEGORY","SERIES"].indexOf(s)!==-1;}});h.prototype.getSelectionBehavior=C.hostVizPropertyGetter("selectionBehavior","interaction.selectability.behavior");h.prototype.getDimensionByName=function(n){return this.getDimensions().filter(function(d){return d.getName()===n;})[0];};h.prototype.getMeasureByName=function(n){return this.getMeasures().filter(function(m){return m.getName()===n;})[0];};return h;});
