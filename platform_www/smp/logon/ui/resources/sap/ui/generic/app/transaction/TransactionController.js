/*
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.define(["jquery.sap.global","./BaseController","./DraftController","sap/ui/generic/app/util/ModelUtil"],function(q,B,D,M){"use strict";var T=B.extend("sap.ui.generic.app.transaction.TransactionController",{metadata:{publicMethods:["destroy","setBatchStrategy","getDraftController","invokeAction","editEntity","deleteEntity","propertyChanged","hasClientValidationErrors","resetChanges"]},constructor:function(m,Q,p){B.apply(this,[m,Q]);this.sName="sap.ui.generic.app.transaction.TransactionController";this._oDraft=null;p=p||{};if(!p.noBatchGroups){m.setDeferredBatchGroups(["Changes"]);m.setChangeBatchGroups({"*":{batchGroupId:"Changes",changeSetId:"Changes",single:false}});}return this.getInterface();}});T.prototype.setBatchStrategy=function(s){var n,c=this._oModel.getChangeBatchGroups();for(n in c){c[n].single=s;}this._oModel.setChangeBatchGroups(c);};T.prototype.getDraftController=function(){if(!this._oDraft){this._oDraft=new D(this._oModel,this._oQueue);}return this._oDraft;};T.prototype.editEntity=function(c){var t=this;return new Promise(function(r){var d,e;d=t.getDraftController().getDraftContext();e=M.getEntitySetFromContext(c);if(d.isDraftEnabled(e)&&t._oDraftUtil.isActiveEntity(c.getObject())){return r(t.getDraftController().createEditDraftEntity(c));}return r({context:c});});};T.prototype.deleteEntity=function(c,p){var P,o,t=this;p=p||{};q.extend(p,{batchGroupId:"Changes",changeSetId:"Changes",successMsg:"Changes were discarded",failedMsg:"Discarding of changes failed",forceSubmit:true,context:c});P=this._remove(c.getPath(),p).then(function(r){return t._normalizeResponse(r,true);},function(r){var R=t._normalizeError(r);throw R;});o=this.triggerSubmitChanges(p);return this._returnPromiseAll([P,o]);};T.prototype.invokeAction=function(f,c,p){var t=this,P,o;P=this.hasClientMessages();if(P){return P;}p={batchGroupId:"Changes",changeSetId:"Changes",successMsg:"Call of action succeeded",failedMsg:"Call of action failed",urlParameters:p.urlParameters,forceSubmit:true,context:c};P=this._callAction(f,c,p).then(function(r){return t._normalizeResponse(r,true);},function(r){var O=t._normalizeError(r);throw O;});this._oModel.refresh(true,false,"Changes");o=this.triggerSubmitChanges(p);return this._returnPromiseAll([P,o]);};T.prototype.resetChanges=function(k){this._oModel.resetChanges(k);};T.prototype.propertyChanged=function(e,p,b){var d,c,P={batchGroupId:"Changes",changeSetId:"Changes",binding:b};d=this.getDraftController().getDraftContext();if(d.checkUpdateOnChange(e,p)){c=b.getBoundContext();if(d.hasDraftPreparationAction(c)){return this.getDraftController().saveAndPrepareDraftEntity(c,P);}P.onlyIfPending=true;return this.triggerSubmitChanges(P);}P.onlyIfPending=true;P.noShowResponse=true;P.noBlockUI=true;return this.triggerSubmitChanges(P);};T.prototype.destroy=function(){B.prototype.destroy.apply(this,[]);if(this._oDraft){this._oDraft.destroy();}this._oDraft=null;};return T;},true);
