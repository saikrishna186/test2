/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.define(["jquery.sap.global","sap/ui/base/EventProvider","./InputDevicePointer","./InputDeviceMouse","./InputDeviceTouch"],function(q,E,I,a,b){"use strict";var L=E.extend("sap.ui.vk.Loco",{metadata:{publicMethods:["addHandler","removeHandler","beginGesture","move","endGesture","contextMenu"]},constructor:function(){if(L._instance){return L._instance;}E.apply(this);this._handlers=[];this._gesture=false;this._touchOrigin={x:0,y:0,z:0};this._touchMoved=false;this._touchButton=0;this._touchStart=0;this._touchEnd=0;this._clickTimer=0;this._isDoubleClick=false;L._instance=this;},destroy:function(){this._gesture=false;this._handlers=[];},addHandler:function(h){this._handlers.push(h);var v=h.getViewport();var p=new I(this);if(p.isSupported()){p.enable(v);v._pointer=p;}else{var m=new a(this);if(m.isSupported()){m.enable(v);v._mouse=m;}var t=new b(this);if(t.isSupported()){t.enable(v);v._touch=t;}}},removeHandler:function(c){var h=this._handlers;var d=h.length;var v=c.getViewport();for(var i=0;i<d;i++){if(h[i]==c){h.splice(i,1);if(v._pointer){v._pointer.disable();v._pointer=null;}if(v._touch){v._touch.disable();v._touch=null;}if(v._mouse){v._mouse.disable();v._mouse=null;}break;}}},_processClick:function(d){this._clickTimer=0;var e={x:0,y:0,z:0,d:0,n:0,buttons:0,scrolls:[],points:[],handled:false};e.x=this._touchOrigin.x;e.y=this._touchOrigin.y;e.z=this._touchOrigin.z;e.buttons=this._touchButton;var h=this._handlers;var c=h.length;for(var i=0;i<c;i++){if(d){h[i].doubleClick(e);}else{h[i].click(e);}if(e.handled){break;}}},_processInput:function(e){var c=e.points;switch(e.n){case 0:e.x=0;e.y=0;e.z=0;e.d=0;break;case 2:var d=c[0].x-c[1].x,f=c[0].y-c[1].y,g=c[0].z-c[1].z;e.x=(c[0].x+c[1].x)/2;e.y=(c[0].y+c[1].y)/2;e.z=(c[0].z+c[1].z)/2;e.d=Math.sqrt(d*d+f*f+g*g);break;default:e.x=c[0].x;e.y=c[0].y;e.z=c[0].z;e.d=0;break;}return e;},beginGesture:function(e){if(this._gesture){return;}if(this._clickTimer>0){clearTimeout(this._clickTimer);this._clickTimer=0;this._isDoubleClick=true;if(e.n==1&&e.buttons<=1&&this._touchButton<=1){this._processClick(true);}}this._processInput(e);var h=this._handlers;var c=h.length;for(var i=0;i<c;i++){h[i].beginGesture(e);if(e.handled){break;}}var n=new Date();this._touchStart=n.getTime();this._touchMoved=false;this._gesture=true;this._touchOrigin.x=e.x;this._touchOrigin.y=e.y;this._touchOrigin.z=e.z;this._touchButton=e.buttons;if(this._touchEnd!=0&&this._touchStart-this._touchEnd<50){this._touchMoved=true;}},move:function(e){if(!this._gesture){return;}this._processInput(e);var h=this._handlers;var c=h.length;for(var i=0;i<c;i++){h[i].move(e);if(e.handled){break;}}var d=this._touchOrigin.x-e.x;var f=this._touchOrigin.y-e.y;var g=this._touchOrigin.z-e.z;if((d*d+f*f+g*g)>8){this._touchMoved=true;}},endGesture:function(e){if(!this._gesture){return;}this._processInput(e);var h=this._handlers;var c=h.length;for(var i=0;i<c;i++){h[i].endGesture(e);if(e.handled){break;}}var n=new Date();this._touchEnd=n.getTime();if(!this._touchMoved&&!this._isDoubleClick&&(this._touchEnd-this._touchStart)<2000){this._clickTimer=setTimeout(function(t){t._processClick(false);},200,this);}this._isDoubleClick=false;this._gesture=false;},contextMenu:function(e){this._processInput(e);var h=this._handlers;var c=h.length;for(var i=0;i<c;i++){h[i].contextMenu(e);if(e.handled){break;}}}});return L;},true);
